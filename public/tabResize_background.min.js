function getResizeParams(a){var b=a.split("-");return{rows:Number(b[2]),cols:Number(b[3])}}function resizeTabs(a,b,c){var d={};d.numRows=b,d.numCols=c;var e=a;$.isEmptyObject(e)?(d.width=Math.round(window.screen.availWidth/d.numCols),d.height=Math.round(window.screen.availHeight/d.numRows),d.offsetX=0,d.offsetY=0,d.fullWidth=window.screen.availWidth,d.fullHeight=window.screen.availHeight):(d.width=Math.round(e.width/d.numCols),d.height=Math.round(e.height/d.numRows),d.offsetX=e.left,d.offsetY=e.top,d.fullWidth=e.width,d.fullHeight=e.height);window.chrome.tabs.query({currentWindow:!0},function(a){d.tabsArray=a,window.chrome.tabs.query({currentWindow:!0,highlighted:!0},function(a){d.currentTab=a[0];var b=d.currentTab.index;a.length>1&&(d.tabsArray=a,b=0);var c=function(){return util.processTabs(d,d.tabsArray,b,d.currentTab.windowId,d.singleTab,d.currentTab.incognito)};d.singleTab?util.setUndoStorage(d,d.currentTab.index,d.currentTab.windowId,d.tabsArray.slice(b,b+1),c):util.setUndoStorage(d,d.currentTab.index,d.currentTab.windowId,d.tabsArray.slice(b),c)})})}localStorage.getItem("updateBadge")||(localStorage.setItem("updateBadge",0),chrome.browserAction.setBadgeText({text:"NEW"}),chrome.browserAction.setBadgeBackgroundColor({color:[221,129,39,255]})),localStorage.getItem("version")||localStorage.setItem("version","2.1.1");var util={createNewWindow:function(a,b,c,d,e,f,g){var h={left:b,top:c,width:d,height:e,incognito:f};a&&(h.tabId=$.isArray(a)?a[0]:a),window.chrome.windows.create(h,function(b){g(b,a)})},processTabs:function(a,b,c,d,e,f){for(var g,h,i,j=b.slice(c),k=0,l=0,m=j.length,n=a.numRows*a.numCols-m,o=this,p=function(b,c){!c&&a.emptyTab?(j.push(b.tabs[0]),l++,n===l&&o.updateUndoStorage(a,j)):c&&$.isArray(c)&&chrome.tabs.move(c.slice(1),{windowId:b.id,index:1})},q=0;q<a.numRows;q++)for(var r=0;r<a.numCols;r++){if(h="left"===a.alignment?r*a.width+a.offsetX:a.fullWidth-(r+1)*a.width+a.offsetX,i=q*a.height+a.offsetY,0===r&&0===q){if(window.chrome.windows.update(j[k].windowId,{left:h,top:i,width:a.width,height:a.height,state:"normal"}),e)return}else{if(g=j[k]?j[k].id:null,!g&&!a.emptyTab)return;if(q===a.numRows-1&&r===a.numCols-1&&m-k>1){g=[];for(var s=k;m>s;s++)g.push(j[s].id)}o.createNewWindow(g,h,i,a.width,a.height,f,p)}k++}},setUndoStorage:function(a,b,c,d,e){window.chrome.windows.get(c,{},function(a){var f={left:a.left,top:a.top,width:a.width,height:a.height,focused:!0,state:"normal",incognito:a.incognito},g={};g.lastWindowInfo=f,g.lastTabIndex=b,g.lastWindowId=c;for(var h=[],i=0;i<d.length;i++)h.push(d[i].id);g.lastTabsArray=h,localStorage.setItem("lastTab",JSON.stringify(g)),chrome.runtime.sendMessage("enable-undo"),e()})},updateUndoStorage:function(a,b){for(var c=JSON.parse(localStorage.getItem("lastTab")),d=[],e=0;e<b.length;e++)d.push(b[e].id);c&&(c.lastTabsArray=d,localStorage.setItem("lastTab",JSON.stringify(c)),chrome.runtime.sendMessage("enable-undo"))},displayInfoFormatter:function(a,b){for(var c,d=0,e=a.length,f={displays:[],primaryIndex:0};e>d;d++)c=a[d],c.id=String(d),f.displays.push({workArea:c.workArea,isEnabled:c.isEnabled,id:c.id}),b.left>c.workArea.left&&b.left<c.workArea.left+c.workArea.width&&b.top>c.workArea.top&&b.top<c.workArea.top+c.workArea.height&&(f.primaryIndex=d);return f}};chrome.commands.onCommand.addListener(function(a){-1!==a.indexOf("tab-resize")&&chrome.system&&chrome.system.display&&chrome.system.display.getInfo(function(b){chrome.windows.getCurrent(function(c){var d={left:c.left+c.width-100,top:c.top+100},e=util.displayInfoFormatter(b,d),f=getResizeParams(a);resizeTabs(e.displays[e.primaryIndex].workArea,f.rows,f.cols)})})});